# RaidRecord

一款用于记录离线版塔克夫战绩的模组

## 更新日志

### 0.6.3

新增
- items指令新增 mode 参数支持 change/all 模式切换物品显示
- 新增 GetParameter<T> 泛型方法，支持从参数字典中安全提取并转换值
- 新增通过 serverId 和 index 精确查找对局存档的功能
- 新增独立的 UpdateItemsChanged 方法，用于统一处理物品变更检测逻辑
- 聊天机器人命令执行流程中新增异常捕获机制，提升稳定性
- 对局开始与结束时补充信息用于辅助判断模组能否正确记录带入带出物品的数据

更改
- 将RaidInfo中的突袭开始和结束处理方法移至RaidUtil工具类
- 新增RaidUtil类统一管理突袭相关的业务逻辑
- 重构了命令系统
- 限制所有储存的命令参数为小写, 以支持客户端可以大小写任意输入
- 重构命令类中的参数解析逻辑，统一调用新工具方法以提高复用性
- 所有命令参数名在解析前统一转为小写，增强命令兼容性与容错能力
- 对局结束获取物品时将不再从Resuts.Profile中获取, 此处疑似是对局开始的存档数据

优化
- 优化物品变更信息的显示格式：限制描述长度、对齐数值列，显著提升可读性
- 简化物品变更检测流程，逻辑更清晰，性能更高效
- 调整物品详情格式化输出，增强可读性
- 修改物品带入带出信息显示格式，明确标示价格计算方式

移除
- 命令系统中移除了`CommandCallback`委托, 改为基于抽象类与派生了实现执行命令
- 移除多处重复的物品变更集合（add/remove/change）清理代码，减少冗余

### 0.6.2

新增
- 通过局内ChatBot获取信息时, 当信息超过一条后会显示当前发送的条数与剩余条数, 这些信息结束位置会显示他们对应的消息列表的开头的一些字符, 用来标记消息所属的信息
- 游戏开始或结束时, 输出信息, 用于判断是否正确记录对局信息
- 支持Scav模式了

变化
- 重构了对局记录的数据结构
- 进行了完整的代码清理与格式化, 优化了代码风格
- 实现了除了命令相关的那些函数外绝大部分非空引用判断
- 部分引用为空时显示错误信息, 方便追踪与报告可能的错误
- `InjectableClasses`由手动注入依赖改为主构造函数注入
- 移除了当战局是Scav时抛出异常的逻辑, 支持Scav模式的战斗记录数据
- 修改 RecordCacheManager 以支持按账户 ID 管理数据
- 修改了RaidRecordManagerChat各个指令获取存档的逻辑, 以获取正确存档

优化
- 优化了长消息接受体验
- 移除了不使用的变量, 移除了冗余初始化
- 使用依赖注入降低了手动解析依赖的风险, 简化了获取依赖的代码
- 优化物品价格计算和库存信息获取方法, 使用类似`InRaidHelper.SetInventory`中的方式

修复
- 修复了无法查看未知结果(中途退出)的战绩详情的问题
- 修复无法把输出目录的dll文件正确拷贝到SPT目录的问题
- 修复了部分错误变量命名规范未清理的问题

已知问题
- ~~游戏开始时info.ServerId意外为null(已修复)~~
- 正常游戏流程下偶现游戏结束时没有发现任何已经开始的对局数据(发现是因为SPT偶尔会处理两次请求, 导致第二次没有数据)
- 暂时不支持跟踪**转移**相关的物品的价值
- 新版本部分信息与报错没有做多语言处理

计划
- 考虑使用资源`.resx`进行多语言支持
- ~~重构RaidInfo相关的成员函数, 降低其对部分参数的依赖和耦合~~
- 重构命令系统, 降低RaidRecordManagerChat的代码长度, 分解相关的代码
- 优化items指令, 或新添更多有用的指令
- 支持**转移**相关的物品的跟踪

### 0.6.1
- 兼容过去版本(0.5.0)的数据库(即db文件夹下所有文件)
- 修复了0.6.0版本大量命令失效的错误
- 迁移0.5.0的代码到新命名空间结构

计划
- 使用新代码风格进行代码清理
- 完善空引用判断
- 完善更详细的日志

已知问题
- ~~未知结果(中途退出)的战绩查看info时没有处理空引用问题~~

### 0.6.0
- 从[RaidRecordOutdated](https://github.com/SunYanbox/raidrecordOutdated)迁移过来
- ~~兼容过去版本(`raidrecord-v0.5.0bate-0.5.0`等)的数据库(即db文件夹下所有文件)~~
- 不兼容模组文件夹名称, 不兼容模组dll文件名称
- 新版本默认使用RaidRecord作为模组文件夹名称与dll文件名称, 方便未来覆盖式更新
